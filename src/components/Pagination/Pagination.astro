---
const { page } = Astro.props;
const { currentPage, lastPage, url } = page;
const { prev, next } = url;

// Generate page numbers
const range = [];
if (lastPage > 1) {
    range.push(1);
    let start = Math.max(2, currentPage - 1);
    let end = Math.min(lastPage - 1, currentPage + 1);

    if (start > 2) {
        range.push('...');
    }
    for (let i = start; i <= end; i++) {
        range.push(i);
    }
    if (end < lastPage - 1) {
        range.push('...');
    }
    if (lastPage > 1) {
        range.push(lastPage);
    }
} else {
    range.push(1);
}

// Deduplicate just in case
const uniqueRange = [...new Set(range)];

// Helper not strictly needed if we trust the logic, but good for safety
// Determine base path for links
// If current is /blog/2, base is /blog
// If current is /blog, base is /blog
// Strip trailing slash first
const currentPath = (url.current || "").replace(/\/$/, "");
const basePath = currentPath.replace(/\/\d+$/, "") || "/blog"; // Default to /blog if empty? likely /blog matches anything

const getLink = (p) => {
    return p === 1 ? basePath : `${basePath}/${p}`;
};

import "./Pagination.less";
---

<section class="vh-art-page">
	<!-- Prev -->
	<a class={`vh-pagination-item${!prev ? " disabled" : ""}`} href={prev || "javascript:;"} title="上一页">
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M15 6l-6 6l6 6"></path></svg>
	</a>

    {/* Pages */}
    {uniqueRange.map((p) => (
        p === '...' ? (
            <span class="vh-pagination-dots">...</span>
        ) : (
            <a class={`vh-pagination-item ${p === currentPage ? "active" : ""}`} href={getLink(p)} title={`第${p}页`}>
                {p}
            </a>
        )
    ))}

	<!-- Next -->
	<a class={`vh-pagination-item${!next ? " disabled" : ""}`} href={next || "javascript:;"} title="下一页">
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 6l6 6l-6 6"></path></svg>
	</a>
</section>
